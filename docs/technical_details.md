# 技術詳細

このドキュメントでは、PDF to PPTX Converter アプリケーションの技術的な側面について説明します。

## 目次

- [アーキテクチャ](#アーキテクチャ)
- [主要コンポーネント](#主要コンポーネント)
  - [GUI (pdf2pptx_gui.py)](#gui-pdf2pptx_guipy)
  - [PDF変換コア (pdf_converter.py)](#pdf変換コア-pdf_converterpy)
  - [ビルドスクリプト (build.py)](#ビルドスクリプト-buildpy)
- [使用ライブラリと技術](#使用ライブラリと技術)
- [変換プロセス](#変換プロセス)
- [エラー処理](#エラー処理)
- [今後の改善点](#今後の改善点)

## アーキテクチャ

このアプリケーションは、主に以下の2つのモジュールで構成されています。

1.  **GUIモジュール (`pdf2pptx_gui.py`):**
    ユーザーインターフェースを担当します。Tkinterライブラリをベースに構築されており、ユーザーからの入力（ファイル選択、変換開始指示など）を受け付け、変換処理の進捗を表示します。

2.  **PDF変換コアモジュール (`pdf_converter.py`):**
    実際のPDFからPPTXへの変換処理を担当します。PyMuPDF (fitz) を使用してPDFを解析し、各ページを画像として抽出します。その後、python-pptxを使用して、これらの画像をPowerPointプレゼンテーションのスライドに配置します。

GUIモジュールは、変換処理をバックグラウンドスレッドで実行することで、UIのフリーズを防いでいます。

## 主要コンポーネント

### GUI (`pdf2pptx_gui.py`)

-   **`PDF2PPTXApp` クラス:** メインアプリケーションウィンドウとUI全体の管理を行います。
    -   TkinterDnD.Tk を継承し、ドラッグ＆ドロップ機能を提供します。
    -   ウィジェット（ボタン、ラベル、プログレスバーなど）の配置とイベント処理を担当します。
    -   PDFファイルの選択、出力先の指定、変換開始のトリガーとなります。
    -   変換処理は `threading.Thread` を使用してバックグラウンドで実行し、UIの応答性を維持します。
    -   `PDFConverter` クラスのインスタンスを利用して実際の変換処理を呼び出します。
-   **`DragDropFrame` クラス:** ドラッグ＆ドロップ操作専用のUIコンポーネントです。
    -   ユーザーが直感的にファイルをドロップできるエリアを提供します。

### PDF変換コア (`pdf_converter.py`)

-   **`PDFConverter` クラス:** PDFからPPTXへの変換ロジックをカプセル化します。
    -   `convert_pdf_to_pptx` メソッド: 主要な変換処理フローを制御します。
        1.  一時作業フォルダのセットアップ (`_setup_temp_folder`)。
        2.  PDFの各ページを画像ファイルに変換 (`_convert_pdf_to_images`)。
            -   PyMuPDF (fitz) を使用してPDFページをレンダリングし、指定されたDPIで画像（デフォルトはJPG）として保存します。
            -   PowerPointのスライドサイズの制限（約4032ピクセル）を超えないように、画像のズーム率を調整します。
        3.  抽出された画像からPowerPointプレゼンテーションを作成 (`_create_pptx_from_images`)。
            -   python-pptx を使用して新しいプレゼンテーションを作成します。
            -   各画像を新しいスライドに、スライド全体をカバーするように配置します。
            -   スライドのサイズは最初の画像のサイズに合わせて設定されます。
        4.  生成された画像を指定された出力フォルダにコピー (`_copy_images_to_output`)。
        5.  一時作業フォルダのクリーンアップ (`_cleanup_temp_folder`)。
    -   進捗状況を通知するためのコールバック関数を受け付け、GUIに進捗を伝えます。

### ビルドスクリプト (`build.py`)

-   PyInstaller を使用して、Pythonスクリプトからスタンドアロンの実行可能ファイル（Windowsの場合は `.exe`、macOSの場合はアプ​​リケーションバンドル）を生成します。
-   主な設定:
    -   `--onefile`: 単一の実行ファイルとしてバンドルします。
    -   `--windowed`: GUIアプリケーションのため、コンソールウィンドウを表示しません。
    -   `--name`: 生成される実行ファイルの名前を指定します。
    -   `--icon`: アプリケーションアイコンを指定します（存在する場合）。
-   OSに応じて実行ファイルの拡張子を自動的に調整します。

## 使用ライブラリと技術

-   **Python 3.x:** アプリケーションの主要なプログラミング言語。
-   **Tkinter:** Python標準のGUIライブラリ。UIの構築に使用。
    -   **tkinterdnd2:** Tkinterでドラッグ＆ドロップ機能を実装するための外部ライブラリ。
-   **PyMuPDF (fitz):** PDFファイルの読み込み、解析、ページごとの画像へのレンダリングに使用。
    -   高DPIでの画像抽出や、PDFの内部構造へのアクセスが可能です。
-   **python-pptx:** PowerPoint (.pptx) ファイルの生成と編集に使用。
    -   スライドの追加、画像の挿入、スライドサイズの調整などを行います。
-   **Pillow (PIL Fork):** 画像のサイズ取得などの基本的な画像処理に使用。
-   **PyInstaller:** Pythonアプリケーションをスタンドアロン実行ファイルにパッケージングするために使用。
-   **Standard Libraries:** `os`, `sys`, `subprocess`, `shutil`, `tempfile`, `threading` など。

## 変換プロセス

1.  ユーザーがGUIを介してPDFファイルを選択し、変換を開始します。
2.  `PDF2PPTXApp` は `PDFConverter` の `convert_pdf_to_pptx` メソッドをバックグラウンドスレッドで呼び出します。
3.  `PDFConverter` は一時フォルダを作成します。
4.  PyMuPDFを使用して、PDFの各ページを指定された解像度（デフォルト300 DPI）で画像ファイル（デフォルトJPG形式）として一時フォルダに保存します。
    -   この際、PowerPointが扱える最大画像サイズを超えないように、画像のズーム率が調整されます。
5.  python-pptxを使用して新しいPowerPointプレゼンテーションを作成します。
6.  最初の抽出画像の寸法に合わせて、プレゼンテーションのスライドサイズが設定されます。
7.  各画像ファイルが、新しいスライドに背景画像として（スライド全体を覆うように）追加されます。
8.  完成したPPTXファイルが、指定された出力フォルダ（または元のPDFと同じフォルダ）に保存されます。
9.  抽出された画像ファイル群も、出力フォルダ内に専用のサブフォルダ（例: `ファイル名_images`）としてコピーされます。
10. 一時フォルダが削除されます。
11. GUIに進捗と結果が通知されます。

## エラー処理

-   ファイルが見つからない、ファイル形式が不正、パスワード付きPDF、メモリ不足、権限エラーなど、変換中に発生しうる一般的なエラーは捕捉され、ユーザーフレンドリーなメッセージとしてGUIに表示されます。
-   `pdf_converter.py` 内では、具体的なエラー（例: PyMuPDFやpython-pptxライブラリからの例外）を捕捉し、より詳細な技術情報と共に上位のGUIモジュールに伝播します。
-   GUI (`pdf2pptx_gui.py`) では、これらのエラーを受け取り、ユーザーに分かりやすい形でダイアログ表示します。

## 今後の改善点

-   **テキストとベクターデータの保持:** 現在はページ全体を画像として変換していますが、可能であればPDF内のテキストやベクターグラフィックを編集可能な形でPowerPointに移行するオプションの検討。
-   **複数ファイルの一括変換:** 複数のPDFファイルを一度に処理できる機能の追加。
-   **画像形式とDPIのカスタマイズ:** ユーザーがGUIから出力画像の形式（PNG/JPG）や解像度（DPI）を選択できるようにする。
-   **詳細なログ出力:** デバッグや問題解決のために、ファイルへのログ出力機能を追加。
-   **多言語対応:** UIの多言語対応。

[戻る](../README.md)
